version: '3.8'

services:
  backend:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
    container_name: sentinelai-backend
    network_mode: "host"       # Nutzt Host-Netzwerk (wichtig für Localhost-Bindung)
    environment:
      - SERVICE_TYPE=backend
      - OLLAMA_HOST=http://127.0.0.1:11434  # Greift auf lokales Ollama zu
      - DATA_DIR=/app/data
      - VECTOR_STORE_DIR=/app/data/vectorstore
    volumes:
      - ../data:/app/data
      - ../logs:/app/logs
    restart: unless-stopped

  frontend:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
    container_name: sentinelai-frontend
    network_mode: "host"       # Nutzt Host-Netzwerk
    environment:
      - SERVICE_TYPE=frontend
      - API_BASE=http://127.0.0.1:8000  # Spricht Backend sicher via Localhost an
    volumes:
      - ../data:/app/data
    depends_on:
      - backend
    restart: unless-stopped

  watcher:
    build:
      context: ..
      dockerfile: deploy/Dockerfile
    container_name: sentinelai-watcher
    network_mode: "host"       # Nutzt Host-Netzwerk
    environment:
      - SERVICE_TYPE=watcher
      - INBOX_DIR=/app/data/inbox
      - PROCESSED_DIR=/app/data/processed
      - ERROR_DIR=/app/data/error
      - API_URL=http://127.0.0.1:8000  # Upload via Localhost
    volumes:
      - ../data:/app/data      # Mapped Host-Ordner für Scanner
    restart: unless-stopped
